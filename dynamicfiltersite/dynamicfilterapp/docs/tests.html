<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>tests.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>tests.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Django tools</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">setup_test_environment</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>What we wrote </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">views_helpers</span> <span class="kn">import</span> <span class="n">eddy</span><span class="p">,</span> <span class="n">eddy2</span><span class="p">,</span> <span class="n">aggregate_responses</span><span class="p">,</span> <span class="n">decrementStatus</span><span class="p">,</span> <span class="n">updateCounts</span><span class="p">,</span> <span class="n">incrementStatus</span><span class="p">,</span> <span class="n">findRestaurant</span><span class="p">,</span> <span class="n">randomAlgorithm</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">RestaurantAdminForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Restaurant</span><span class="p">,</span> <span class="n">RestaurantPredicate</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">PredicateBranch</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Python tools</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">normal</span><span class="p">,</span> <span class="n">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip_longest</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>set the modules of the imported functions so that Sphinx doesn't generate documentation for them
(some libraries have a default module of 'None' which Sphinx fills in as belonging to this module
unless it's otherwise defined)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">random</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="s">&quot;random&quot;</span>
<span class="n">normal</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="s">&quot;random&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Creates and saves a new task with the specified field values.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">enterTask</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">workerAnswer</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">confidence</span><span class="p">,</span> <span class="n">predicate</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="n">workerID</span><span class="o">=</span><span class="n">ID</span><span class="p">,</span> <span class="n">completionTime</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="n">workerAnswer</span><span class="p">,</span> <span class="n">confidenceLevel</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">restaurantPredicate</span><span class="o">=</span><span class="n">predicate</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">task</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Makes a new restaurant with a given name and zip code, which the caller provides to ensure uniqueness.
Also creates three corresponding predicates and predicate branches. (No longer in use since we're doing 10 predicates.)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">enterRestaurant</span><span class="p">(</span><span class="n">restaurantName</span><span class="p">,</span> <span class="n">zipNum</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">r</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">restaurantName</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">&quot;www.test.com&quot;</span><span class="p">,</span> <span class="n">street</span><span class="o">=</span><span class="s">&quot;Test Address&quot;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&quot;Berkeley&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">&quot;CA&quot;</span><span class="p">,</span>
        <span class="n">zipCode</span><span class="o">=</span><span class="n">zipNum</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">&quot;USA&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Please answer a question!&quot;</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">queueIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Create the three associated predicates</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">restaurant</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="s">&quot;Does this restaurant accept credit cards?&quot;</span><span class="p">)</span>
    <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">restaurant</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="s">&quot;Is this a good restaurant for kids?      &quot;</span><span class="p">)</span>
    <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">restaurant</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="s">&quot;Does this restaurant serve Choco Pies?   &quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Create the three predicate branches if they don't exist yet</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">predicate</span> <span class="ow">in</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">predicate</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="n">predicate</span><span class="o">.</span><span class="n">question</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Create and save a PredicateBranch with the specified field values.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">enterPredicateBranch</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">returnedTotal</span><span class="p">,</span> <span class="n">returnedNo</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">returnedTotal</span><span class="o">=</span><span class="n">returnedTotal</span><span class="p">,</span> <span class="n">returnedNo</span><span class="o">=</span><span class="n">returnedNo</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>We run simulations of our algorithm to evaluate its performance against other algorithms. In general, we use a test database of 
items and predicates, and use the algorithm to "ask" questions, which are answered with simulated worker responses. These worker responses 
are sampled from a set of pre-gathered Mechanical Turk HITs. Parameters for the simulations are specified in the test_controller method, 
which are what should be called to run the simulations.</p>
<p>The simulations may also be run using made-up worker responses (generated using Python's random functions). Methods for such simulations
have been moved to simulation_generated_responses.py.</p>
<p>To run simulations: 
python manage.py test dynamicfilterapp.tests.SimulationTest.test_sample_data_simulation_controller</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">SimulationTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Calls the many_simulations function once for each set of specified parameters. One simulation is one run of each algorithm. The user
may specify any number of simulations to be run with each set of parameters.
The user may edit other values in this method to change simulation parameters what information is recorded about the simulations.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>If True, number of tasks and correct percentage for each run of each algorithm will be recorded in one file.
Generates one file per parameter set defined below.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">recordAggregateStats</span> <span class="o">=</span> <span class="bp">True</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>If True, information about individual runs of the algorithm will be recorded in separate files.
Will generate one file per algorithm per simulation.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">eddy</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">eddy2</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">random</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="n">parameterSets</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>selectivity 0, selectivity 1, selectivity 2, branchDifficulties dictionary</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>A set of parameters for one call to many_simulations
The user may copy these lines to define and append more sets of parameters, which will results
in more calls to many_simulations</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">set1</span> <span class="o">=</span><span class="p">[</span> <span class="mi">1000</span><span class="p">,</span> <span class="c"># number of simulations to be run with these parameters</span>
                <span class="mi">20</span><span class="p">,</span> <span class="c"># number of restaurants</span>
                <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="c"># indices of the questions to use (between 1 and 10 questions may be specified, with indices 0 to 9)</span>
                <span class="n">recordAggregateStats</span><span class="p">,</span>
                <span class="n">eddy</span><span class="p">,</span>
                <span class="n">eddy2</span><span class="p">,</span>
                <span class="n">random</span>
                <span class="p">]</span>
        <span class="n">parameterSets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>call many_simulations for each parameter set</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">parameters</span> <span class="ow">in</span> <span class="n">parameterSets</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Parameter set: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">many_simulations</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>an audio alert that plays when the tests are complete
note: customizable to say any message :)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;say &quot;Aye aye, captain!&quot;&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Runs one simulation of the filtering process with one specified algorithm.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">predicateAnswers</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>get the simulation parameters from the parameters list</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">QUESTION_INDICES</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">numOfPredicates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTION_INDICES</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>parameters for the task completion time distribution
currently not used for anything in the algorithm</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">AVERAGE_TIME</span> <span class="o">=</span> <span class="mi">60000</span> <span class="c"># 60 seconds</span>
        <span class="n">STANDARD_DEV</span> <span class="o">=</span> <span class="mi">20000</span> <span class="c"># 20 seconds</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>the header for the outputted csv file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">results</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;taskCount&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity0&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity1&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity2&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity3&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity4&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity5&quot;</span><span class="p">,</span> 
                    <span class="s">&quot;Selectivity6&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity7&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity8&quot;</span><span class="p">,</span> <span class="s">&quot;Selectivity9&quot;</span><span class="p">,</span> <span class="s">&quot;Predicate Evaluated&quot;</span><span class="p">,</span> <span class="s">&quot;Answer&quot;</span><span class="p">,</span> <span class="s">&quot;tasksPerRestaurant&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Task &amp; Answer Distribution&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Evaluated Answers&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Correct Answers&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span> <span class="s">&quot;------&quot;</span><span class="p">,</span>  <span class="s">&quot;------&quot;</span><span class="p">,</span>  <span class="s">&quot;------&quot;</span><span class="p">,</span>  <span class="s">&quot;------&quot;</span><span class="p">,</span>  <span class="s">&quot;------&quot;</span><span class="p">,</span>  <span class="s">&quot;------&quot;</span><span class="p">,</span>  <span class="s">&quot;------&quot;</span><span class="p">]]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Initialize all the lists where data will be recorded, which will be written into a results file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>how many Tasks are required to decide if each Restaurant passes the filter</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">tasksPerRestaurant</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>a list of lists, where the selectivity of each PredicateBranch is recorded after every Task is entered</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">selectivities</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>keeps an index for each Task completed -- mainly useful for printing in results file next to other data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">taskCount</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>an ordered list of all the answers given in Tasks</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">taskAnswers</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>a list of which PredicateBranches were evaluated</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">branchHistory</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>what percent of items are done being evaluated, recorded after every task</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">percentDone</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>We sample with replacement from a small set of answers, so we don't bother for simulating workers doing multiple tasks
Rather, for the sake of simplicity, each Task is done by a worker with a new ID
start keeping track of worker IDs at 100</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">IDcounter</span> <span class="o">=</span> <span class="mi">100</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>choose one predicate to start</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">predicate</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">IDcounter</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTION_INDICES</span><span class="p">))</span>
        <span class="n">taskIndex</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Run this loop until there are no more predicates needing evaluation</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">while</span> <span class="p">(</span><span class="n">predicate</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>get the current set of PredicateBranches (accessed here to make sure we have the up-to-date versions of the PBs)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">currentBranches</span> <span class="o">=</span> <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>add the current selectivity statistics to the results file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">currentBranches</span><span class="p">)):</span>
                <span class="n">selectivities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">currentBranches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">returnedNo</span><span class="o">/</span><span class="n">currentBranches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">returnedTotal</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>note the percent of items complete</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">numDone</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">queueIndex</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="mf">1.0</span>
            <span class="n">numTotal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span><span class="o">*</span><span class="mf">1.0</span>
            <span class="n">percentDone</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numDone</span><span class="o">/</span><span class="n">numTotal</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>choose a time by sampling from a distribution</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">completionTime</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="n">AVERAGE_TIME</span><span class="p">,</span> <span class="n">STANDARD_DEV</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>"I don't know" answers aren't used (In algorithm these answers are ignored)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">value</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="n">predicate</span><span class="p">])</span>
            <span class="k">while</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="n">predicate</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>the boolean (Yes/No) aspect of the answer is encoded as the sign of value</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>The confidence level is encoded as the magnitude of value</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">confidenceLevel</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>make Task answering the predicate</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">task</span> <span class="o">=</span> <span class="n">enterTask</span><span class="p">(</span><span class="n">IDcounter</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">completionTime</span><span class="p">,</span> <span class="n">confidenceLevel</span><span class="p">,</span> <span class="n">predicate</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>record and increment the task index</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">taskCount</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taskIndex</span><span class="p">)</span>
            <span class="n">taskIndex</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>update the other results file data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">branchHistory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">restaurantPredicate</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">taskAnswers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>update the appropriate status fields and counts</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">pB</span> <span class="o">=</span> <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">predicate</span><span class="o">.</span><span class="n">question</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">updateCounts</span><span class="p">(</span><span class="n">pB</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
            <span class="n">decrementStatus</span><span class="p">(</span><span class="n">predicate</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>if we're done answering questions, aggregate the responses</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">statusName</span> <span class="o">=</span> <span class="s">&quot;predicate&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;Status&quot;</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="p">,</span> <span class="n">statusName</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span> <span class="o">=</span> <span class="n">aggregate_responses</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>"move" the restaurant out of the PredicateBranch</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>update the queue index (only used by eddy2)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">queueIndex</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>set the queue index to be right after the current last thing</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">currentLastIndex</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-queueIndex&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">queueIndex</span>
                <span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">queueIndex</span> <span class="o">=</span> <span class="n">currentLastIndex</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">predicate</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">IDcounter</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>get the next predicate from the eddy (None if there are no more)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">predicate</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">IDcounter</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTION_INDICES</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>extract data for results file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">branches</span> <span class="o">=</span> <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>print selectivities</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">restaurant</span> <span class="ow">in</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">tasksPerRestaurant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">restaurantPredicate__restaurant</span><span class="o">=</span><span class="n">restaurant</span><span class="p">)))</span>
    
        <span class="n">predicateList</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Predicate&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
            <span class="n">predicateList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;predicate &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Tasks&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">restaurantPredicate__index</span><span class="o">=</span><span class="n">i</span><span class="p">)))</span>

        <span class="n">returnedNo</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Returned No&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
            <span class="n">returnedNo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">returnedNo</span><span class="p">)</span>

        <span class="n">returnedTotal</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Returned Total&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">)):</span>
            <span class="n">returnedTotal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">returnedTotal</span><span class="p">)</span>

        <span class="n">rests</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Restaurant&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>answers entered in by workers</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">answers</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
        <span class="n">predicateCorrectAnswers</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; True&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">rests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numOfPredicates</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">restaurant</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicateAnswers</span><span class="p">[(</span><span class="n">p</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">question</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>zip lists so that they are written as columns, not rows</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">taskCount</span><span class="p">,</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> 
        <span class="n">selectivities</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">selectivities</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">wheresWaldo</span><span class="p">,</span> <span class="n">taskAnswers</span><span class="p">,</span> 
        <span class="n">tasksPerRestaurant</span><span class="p">,</span> <span class="n">predicateList</span><span class="p">,</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">returnedNo</span><span class="p">,</span> <span class="n">returnedTotal</span><span class="p">,</span> <span class="n">rests</span><span class="p">,</span> <span class="n">answers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> 
        <span class="n">answers</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">answers</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
        <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> 
        <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> 
        <span class="n">predicateCorrectAnswers</span><span class="p">[</span><span class="mi">9</span><span class="p">]):</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>append a column of percent done data to the existing file
TODO see if this method is more elegant for the other data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">algorithm</span><span class="o">==</span><span class="n">eddy2</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;adding to csv&quot;</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;percentdone.csv&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="p">[</span><span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">[</span><span class="n">percentDone</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">results</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>Read in the correct answers to 10 questions about 20 Restaurants from a csv file and store them in a dictionary
where the key is a tuple (Restaurant, question) and the value is a boolean.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_correct_answers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">uniqueQuestionsList</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>read in correct answer data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">answers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> 
                                <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S30&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span>
                                                   <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span>
                                                   <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span>
                                                   <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),],</span>
                                        <span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Restaurant&#39;</span><span class="p">,</span> <span class="s">&#39;a0&#39;</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">,</span> <span class="s">&#39;a2&#39;</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">,</span>
                                                  <span class="s">&#39;a4&#39;</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">,</span> <span class="s">&#39;a6&#39;</span><span class="p">,</span> <span class="s">&#39;a7&#39;</span><span class="p">,</span>
                                                  <span class="s">&#39;a8&#39;</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">]},</span>
                                <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>
                                <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
                                <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>create a dictionary of (restaurant, question) keys and boolean correct answer values</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">correctAnswers</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>fill in the dictionary with values read in</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">restRow</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">restRow</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniqueQuestionsList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">correctAnswers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">correctAnswers</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>Reads in a file of pre-gathered Mechanical Turk HITs and makes a dictionary where the key is a RestaurantPredicate and
the value is a list of all the HITs for that RestaurantPredicate. This list is the set that our simulations can sample 
answers from. At present, the csv file downloaded from Mechanical Turk must be copied and then edited to only include 
the six columns of data that we use here.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_sample_answer_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>read in worker data from cleaned file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> 
                            <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S30&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S15&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
                                               <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S50&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span>
                                    <span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;AssignmentId&#39;</span><span class="p">,</span> <span class="s">&#39;WorkerId&#39;</span><span class="p">,</span> <span class="s">&#39;WorkTimeInSeconds&#39;</span><span class="p">,</span>
                                              <span class="s">&#39;Input.Restaurant&#39;</span><span class="p">,</span> <span class="s">&#39;Input.Question&#39;</span><span class="p">,</span> <span class="s">&#39;Answer.Q1AnswerPart1&#39;</span><span class="p">]},</span>
                            <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>
                            <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
                            <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>Get a list of all the tasks in the file, represented as tuples of (resturant, question, answer)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">restaurant</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">assignmentId</span><span class="p">,</span> <span class="n">workerId</span><span class="p">,</span> <span class="n">workTimeInSeconds</span><span class="p">,</span> <span class="n">restaurant</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>create the dictionary and populate it with empty lists</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">sampleData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">sampleData</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <p>Add every task's answer into the appropriate list in the dictionary</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="n">restaurant</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>answer==0 means worker answered "I don't know"</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="n">answer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <p>get the RestaurantPredicates matching this task (will be a QuerySet of length 1 or 0)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">predKey</span> <span class="o">=</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">restaurant__name</span><span class="o">=</span><span class="n">restaurant</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>Some tasks won't have matching RestaurantPredicates, since we may not be using all the possible predicates</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predKey</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sampleData</span><span class="p">[</span><span class="n">predKey</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sampleData</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>A manager function that calls run_simulation a certain number of times with various algorithms.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">many_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>files to read in correct answers and pre-gathered HITs
TODO consider an alternate strategy so file names aren't hard-coded here (maybe put them in the controller)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">correctAnswersFile</span> <span class="o">=</span> <span class="s">&quot;MTurk_Results/correct_answers.csv&quot;</span>
        <span class="n">cleanedDataFilename</span> <span class="o">=</span> <span class="s">&quot;MTurk_Results/Batch_2019634_batch_results_cleaned.csv&quot;</span>

        <span class="n">NUM_SIMULATIONS</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">NUM_RESTAURANTS</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">QUESTION_INDICES</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      <p>record simulation-identifying information to be put in each results file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">label</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&quot;Parameters:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">)])</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="c"># get the timestamp</span>
        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&quot;Time stamp:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>get a list of the unique questions by pulling out the headers of the correct answers file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">uniqueQuestions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">correctAnswersFile</span><span class="p">,</span> 
                                    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;S100&#39;</span><span class="p">),],</span>
                                            <span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;a0&#39;</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">,</span> <span class="s">&#39;a2&#39;</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">,</span>
                                                      <span class="s">&#39;a4&#39;</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">,</span> <span class="s">&#39;a6&#39;</span><span class="p">,</span> <span class="s">&#39;a7&#39;</span><span class="p">,</span>
                                                      <span class="s">&#39;a8&#39;</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">]},</span>
                                    <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>
                                    <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>
                                    <span class="n">skip_footer</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
        <span class="n">uniqueQuestionsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">uniqueQuestions</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>Create restaurants with corresponding RestaurantPredicates and PredicateBranches</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>Our simulations use the same 20 Restaurants</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">restaurantNames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Rivoli&quot;</span><span class="p">,</span> <span class="s">&quot;Zachary&#39;s Chicago Pizza&quot;</span><span class="p">,</span> <span class="s">&quot;Gather&quot;</span><span class="p">,</span> <span class="s">&quot;Angeline&#39;s Louisiana Kitchen&quot;</span><span class="p">,</span> <span class="s">&quot;Comal&quot;</span><span class="p">,</span>
                            <span class="s">&quot;La Note Restaurant Provencal&quot;</span><span class="p">,</span> <span class="s">&quot;Ajanta&quot;</span><span class="p">,</span> <span class="s">&quot;Vik&#39;s Chaat and Market&quot;</span><span class="p">,</span> <span class="s">&quot;Chez Panisse&quot;</span><span class="p">,</span> <span class="s">&quot;Cheese Board Pizza&quot;</span><span class="p">,</span>
                            <span class="s">&quot;FIVE&quot;</span><span class="p">,</span> <span class="s">&quot;Oliveto Restaurant&quot;</span><span class="p">,</span> <span class="s">&quot;Bette&#39;s Oceanview Diner&quot;</span><span class="p">,</span> <span class="s">&quot;Platano&quot;</span><span class="p">,</span> <span class="s">&quot;Brazil Cafe&quot;</span><span class="p">,</span>
                            <span class="s">&quot;Gregoire&quot;</span><span class="p">,</span> <span class="s">&quot;Toss Noodle Bar&quot;</span><span class="p">,</span> <span class="s">&quot;Eureka!&quot;</span><span class="p">,</span> <span class="s">&quot;Great China&quot;</span><span class="p">,</span> <span class="s">&quot;Urbann Turbann&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_RESTAURANTS</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">restaurantNames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="s">&quot;www.test.com&quot;</span><span class="p">,</span> <span class="n">street</span><span class="o">=</span><span class="s">&quot;Test Address&quot;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&quot;Berkeley&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">&quot;CA&quot;</span><span class="p">,</span>
            <span class="n">zipCode</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">&quot;USA&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Please answer a question!&quot;</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">queueIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
            <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">numOfPredicates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTION_INDICES</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <p>create predicate branches using the specified questions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">pbIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">QUESTION_INDICES</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">uniqueQuestionsList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">enterPredicateBranch</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">pbIndex</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">pbIndex</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      <p>get a list of the indices of questions we aren't using</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">unselectedQuestions</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">QUESTION_INDICES</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>update the unselected PredicateBranches so they follow the selected oness</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unselectedQuestions</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">uniqueQuestionsList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">enterPredicateBranch</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">pbIndex</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">pbIndex</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">index__lt</span><span class="o">=</span><span class="n">numOfPredicates</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>make a corresponding predicate for each restaurant</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">RestaurantPredicate</span><span class="p">(</span><span class="n">restaurant</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">question</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>get the boolean values controlling which data are recorded in files</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">recordAggregateStats</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">recordEddyStats</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">recordEddy2Stats</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">recordRandomStats</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>get a dictionary of known correct answers where the key is (restaurant, question) and the value is a boolean</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">predicateAnswers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_correct_answers</span><span class="p">(</span><span class="n">correctAnswersFile</span><span class="p">,</span> <span class="n">uniqueQuestionsList</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>gets a dictionary of the answers from the sample data, where the key is a predicate and the value is a list of answers</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">sampleDataDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sample_answer_dict</span><span class="p">(</span><span class="n">cleanedDataFilename</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>make the header for the aggregate results csv</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">aggregateResults</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;eddy num tasks&quot;</span><span class="p">,</span> <span class="s">&quot;eddy correct percentage&quot;</span><span class="p">,</span> <span class="s">&quot;eddy 2 num tasks&quot;</span><span class="p">,</span> <span class="s">&quot;eddy2 correct percentage&quot;</span><span class="p">,</span> 
                           <span class="s">&quot;random num tasks&quot;</span><span class="p">,</span> <span class="s">&quot;random correct percentage&quot;</span><span class="p">]]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>start the file where we'll record the percent done data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;percentdone.csv&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
            <span class="p">[</span><span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;percentDone&quot;</span><span class="p">]]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>Use the established items, questions, selectivities, difficulties, etc to run as many simulations as specified
Each algorithm (eddy, eddy2, and random) is run NUM_SIMULATIONS times</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_SIMULATIONS</span><span class="p">):</span>

            <span class="k">print</span> <span class="s">&quot;Eddy &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">results_eddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span><span class="n">eddy</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">predicateAnswers</span><span class="p">,</span> <span class="n">sampleDataDict</span><span class="p">)</span>
            <span class="n">eddyTasks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      <p>Of the answered predicates, count how many are correct</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">correctCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">predicate</span> <span class="ow">in</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">predicate</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">predicateAnswers</span><span class="p">[(</span><span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">predicate</span><span class="o">.</span><span class="n">question</span><span class="p">)]:</span>
                    <span class="n">correctCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">eddyCorrectPercentage</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">correctCount</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">recordEddyStats</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_results</span><span class="p">(</span><span class="n">results_eddy</span><span class="p">,</span> <span class="s">&quot;eddy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_simulation</span><span class="p">()</span>

            <span class="k">print</span> <span class="s">&quot;Eddy2 &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">results_eddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span><span class="n">eddy2</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">predicateAnswers</span><span class="p">,</span> <span class="n">sampleDataDict</span><span class="p">)</span>
            <span class="n">eddy2Tasks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      <p>Of the answered predicates, count how many are correct</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">correctCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">predicate</span> <span class="ow">in</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">predicate</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">predicateAnswers</span><span class="p">[(</span><span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">predicate</span><span class="o">.</span><span class="n">question</span><span class="p">)]:</span>
                    <span class="n">correctCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">eddy2CorrectPercentage</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">correctCount</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">recordEddyStats</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_results</span><span class="p">(</span><span class="n">results_eddy</span><span class="p">,</span> <span class="s">&quot;eddy2&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_simulation</span><span class="p">()</span>

            <span class="k">print</span> <span class="s">&quot;Random &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">results_random</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span><span class="n">randomAlgorithm</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">predicateAnswers</span><span class="p">,</span> <span class="n">sampleDataDict</span><span class="p">)</span>
            <span class="n">randomTasks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      <p>Of the answered predicates, count how many are correct</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">correctCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">predicate</span> <span class="ow">in</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">predicate</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">predicateAnswers</span><span class="p">[(</span><span class="n">predicate</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">predicate</span><span class="o">.</span><span class="n">question</span><span class="p">)]:</span>
                    <span class="n">correctCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">randomCorrectPercentage</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">correctCount</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">recordRandomStats</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_results</span><span class="p">(</span><span class="n">results_random</span><span class="p">,</span> <span class="s">&quot;random&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_simulation</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">recordAggregateStats</span><span class="p">:</span> <span class="n">aggregateResults</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">eddyTasks</span><span class="p">,</span> <span class="n">eddyCorrectPercentage</span><span class="p">,</span> <span class="n">eddy2Tasks</span><span class="p">,</span> <span class="n">eddy2CorrectPercentage</span><span class="p">,</span> <span class="n">randomTasks</span><span class="p">,</span> <span class="n">randomCorrectPercentage</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_database</span><span class="p">()</span>
  
        <span class="k">if</span> <span class="n">recordAggregateStats</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_results</span><span class="p">(</span><span class="n">aggregateResults</span><span class="p">,</span> <span class="s">&quot;aggregate_results&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      <p>Write results from a list into a csv file named using a timestamp.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">write_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="c"># get the timestamp</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      <p>write the number of tasks and correct percentage to a csv file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;test_results/&#39;</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">time</span><span class="p">())[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.csv&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
            <span class="p">[</span><span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      <p>Clear out answers and reset status values while not deleting Restaurants, RestaurantPredicates, or PredicateBranches</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">reset_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      <p>deletes all tasks in database</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      <p>set all predicate values to none</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">pred</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">pred</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-93'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-93'>#</a>
      </div>
      <p>reset predicate statuses to 5</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">resetIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate0Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate1Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate2Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate3Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate4Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate5Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate6Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate7Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate8Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">predicate9Status</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">hasFailed</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">queueIndex</span> <span class="o">=</span> <span class="n">resetIndex</span>
            <span class="n">resetIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-94'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-94'>#</a>
      </div>
      <p>reset returned total and returned no to 1</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">branch</span><span class="o">.</span><span class="n">returnedTotal</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">branch</span><span class="o">.</span><span class="n">returnedNo</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">branch</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-95'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-95'>#</a>
      </div>
      <p>Remove all objects from the test database.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">clear_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-96'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-96'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">RestaurantPredicate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">PredicateBranch</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
